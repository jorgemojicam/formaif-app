<ng-template #loading>
    <div class="container-spinner">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>
<ng-container *ngIf="loadData; else loading">
    <form [formGroup]="actividadesForm">

        <button mat-mini-fab type="button" class="addact" [disabled]="actividades().controls.length>=6" color="primary"
            (click)="addActividad()">
            <mat-icon>add</mat-icon>
        </button>

        <mat-tab-group mat-align-tabs="start" [selectedIndex]="selected.value"
            (selectedIndexChange)="selected.setValue($event)">
            <div formArrayName="act" fxFlex="100%">

                <mat-tab *ngFor="let acti of actividades().controls; let ac=index">
                    <ng-template mat-tab-label>
                        <ng-container *ngIf="ac==0">Principal</ng-container>
                        <ng-container *ngIf="ac>0">Act {{ac + 1}}</ng-container>
                    </ng-template>
                    <div [formGroupName]="ac">
                        <!-- encabezado -->
                        <div class="encabezado">
                            <mat-card>
                                <mat-card-content>
                                    <div fxLayout="row wrap">
                                        <button class="deleteact" color="warn" mat-icon-button [disabled]="ac==0"
                                            (click)="deleteAct(ac)">
                                            <mat-icon>cancel</mat-icon>
                                        </button>

                                        <div class="gr" fxFlex="35%" fxFlex.xs="30%" fxFlex.sm="35%">
                                            <mat-form-field>
                                                <mat-label>Tipo Actividad</mat-label>
                                                <mat-select formControlName="tipo" (selectionChange)="onTipoChange(ac,acti)" required>
                                                    <mat-option>--</mat-option>
                                                    <mat-option *ngFor="let tip of tipoActRural"
                                                        [value]="tip.id">
                                                        {{tip.name}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                        <div class="gr" fxFlex="35%" fxFlex.xs="35%" fxFlex.sm="35%">
                                            <mat-form-field class="example-full-width">
                                                <mat-label>Actividad</mat-label>
                                                <ng-container *ngIf="acti.value.tipo ==3">
                                                    <input type="text" matInput formControlName="nombre">
                                                </ng-container>
                                                <ng-container *ngIf="acti.value.tipo !=3">
                                                    <input type="text" (change)="displayBlack(acti,ac)" matInput
                                                        formControlName="nombre" [matAutocomplete]="auto">
                                                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)='changeActi(ac)' [displayWith]="displayFn">
                                                        <mat-option
                                                            *ngFor="let option of _filter(acti.value.nombre,acti.value.tipo,ac)"
                                                            [value]="option">
                                                            {{option.name}}
                                                        </mat-option>
                                                    </mat-autocomplete>
                                                </ng-container>
                                            </mat-form-field>
                                        </div>
                                        <div class="gr" fxFlex="30%" fxFlex.xs="35%" fxFlex.sm="30%">
                                            <ng-container *ngIf="acti.value.tipo ==1">
                                                <mat-form-field>
                                                    <input type="text" matInput placeholder="Tipo Producción"
                                                        value="{{acti.value.nombre.tipoproducto}}"
                                                        id="tipoproduccion{{ac}}" formControlName="tipoproduccion"
                                                        readonly>
                                                </mat-form-field>
                                            </ng-container>
                                            <ng-container *ngIf="acti.value.tipo ==2">
                                                <mat-form-field>
                                                    <mat-label>Tipo de producción</mat-label>
                                                    <mat-select formControlName="tipoproduccion"
                                                        id="tipoproduccion{{ac}}" required>
                                                        <mat-option>--</mat-option>
                                                        <mat-option *ngFor="let tip of tipoprodPecu" [value]="tip.id">
                                                            {{tip.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </ng-container>
                                            <ng-container *ngIf="acti.value.tipo ==3">
                                                <mat-form-field>
                                                    <mat-label>Tipo Actividad</mat-label>
                                                    <mat-select formControlName="tipoproduccion"
                                                        [compareWith]="compareFunction" required>
                                                        <mat-option>--</mat-option>
                                                        <mat-option *ngFor="let tip of tipoAct" [value]="tip.id">
                                                            {{tip.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </ng-container>
                                        </div>
                                    </div>
                                </mat-card-content>
                                <button *ngIf="acti.value.tipo ==1" mat-fab aria-label="add" mat-mini-fab class="btnadd"
                                    type="button" [disabled]="lotes(ac).controls.length >= 6" color="accent"
                                    (click)="addLotes(ac)">
                                    <mat-icon>add</mat-icon>
                                </button>
                                <button *ngIf="acti.value.tipo ==2" mat-fab aria-label="add" mat-mini-fab class="btnadd"
                                    type="button" [disabled]="lotesPecuario(ac).controls.length >= 6" color="accent"
                                    (click)="addLotesPecuario(ac)">
                                    <mat-icon>add</mat-icon>
                                </button>
                            </mat-card>
                        </div>

                        <!-- precio -->
                        <ng-container *ngIf="acti.value.tipo">
                            <ng-container *ngIf="acti.value.tipo!=3">
                                <div class="precio">
                                    <mat-card>
                                        <mat-card-content>
                                            <div fxLayout="row wrap">
                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-form-field>
                                                        <mat-label>Unidad Venta</mat-label>
                                                        <mat-select formControlName="unidadventa" id="unidadventa{{ac}}"
                                                            required>
                                                            <mat-option>--</mat-option>
                                                            <mat-option *ngFor="let un of unidades" [value]="un">
                                                                {{un.name}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="tel" matInput placeholder="Precio Min"
                                                            autocomplete="off" formControlName="preciomin">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="tel" matInput placeholder="Precio Actual"
                                                            autocomplete="off" formControlName="precioactual">
                                                    </mat-form-field>
                                                </div>

                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="text" matInput placeholder="Precio Promedio"
                                                            readonly formControlName="preciopromedio">
                                                    </mat-form-field>
                                                </div>
                                                <ng-container *ngIf="acti.value.tipo==1">
                                                    <!-- Permanente meses cosecha,pepeo,traviesa-->
                                                    <ng-container *ngIf="acti.value.nombre.tipoproducto=='Permanente'">

                                                        <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                            <mat-form-field>
                                                                <mat-label>Cosecha</mat-label>
                                                                <mat-select formControlName="mesCos" multiple
                                                                    id="mesCos{{ac}}" required>
                                                                    <mat-option *ngFor="let mes of meses"
                                                                        [disabled]="acti.value.mesTra.indexOf(mes.id) >= 0 || acti.value.mesPepeo.indexOf(mes.id) >= 0"
                                                                        [value]="mes.id">
                                                                        {{mes.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                            <mat-form-field>
                                                                <mat-label>Traviesa</mat-label>
                                                                <mat-select formControlName="mesTra" multiple
                                                                    id="mesTra{{ac}}" required>
                                                                    <mat-option *ngFor="let mes of meses"
                                                                        [disabled]="acti.value.mesCos.indexOf(mes.id) >= 0 || acti.value.mesPepeo.indexOf(mes.id) >= 0"
                                                                        [value]="mes.id">
                                                                        {{mes.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                            <mat-form-field>
                                                                <mat-label>Pepeo</mat-label>
                                                                <mat-select formControlName="mesPepeo" multiple
                                                                    id="mesPepeo{{ac}}" required>
                                                                    <mat-option *ngFor="let mes of meses"
                                                                        [disabled]="acti.value.mesCos.indexOf(mes.id) >= 0 || acti.value.mesTra.indexOf(mes.id) >= 0"
                                                                        [value]="mes.id">
                                                                        {{mes.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                            </div>
                                        </mat-card-content>
                                    </mat-card>
                                </div>
                            </ng-container>
                        </ng-container>

                        <ng-container [ngSwitch]="acti.value.tipo">

                            <!-- agricola -->
                            <ng-container *ngSwitchCase="1">
                                <!-- Lotes agro -->
                                <div formArrayName="lotesAgro">
                                    <mat-accordion class="example-headers-align" multi>
                                        <mat-expansion-panel *ngFor="let lote of lotes(ac).controls; let lot=index"
                                            [formGroupName]="lot">
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>
                                                    Lote
                                                </mat-panel-title>
                                                <mat-panel-description fxLayout="row">
                                                    <span *ngIf="lot>0"># {{lot}}</span> <span
                                                        *ngIf="lot==0">Principal</span>
                                                    <mat-icon>local_florist</mat-icon>
                                                    <button (click)="removeLotes(ac,lot)" [disabled]="lot==0"
                                                        color="warn" mat-icon-button type="button">
                                                        <mat-icon>cancel</mat-icon>
                                                    </button>
                                                </mat-panel-description>
                                            </mat-expansion-panel-header>
                                            <div fxLayout="row wrap">
                                                <div class="gr" fxFlex="30%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="number" matInput placeholder="Edad Cultivo"
                                                            id="edadcult{{ac}}-{{lot}}" formControlName="edadcult">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <mat-label>Edad</mat-label>
                                                        <mat-select formControlName="periodoedad"
                                                            id="periodoedad{{ac}}-{{lot}}" required>
                                                            <mat-option>--</mat-option>
                                                            <mat-option *ngFor="let ed of edadPeriodo" [value]="ed.id">
                                                                {{ed.name}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="number" matInput placeholder="Area m2"
                                                            id="areacult{{ac}}-{{lot}}" formControlName="areacult">
                                                    </mat-form-field>
                                                </div>
                                                <div fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-card class="cardlote">
                                                        <mat-card-content>
                                                            <mat-slide-toggle formControlName="aplicadiastancia">
                                                                Distancia de siembra
                                                            </mat-slide-toggle>
                                                        </mat-card-content>
                                                    </mat-card>
                                                </div>
                                                <br>
                                                <ng-container *ngIf="lote.value.aplicadiastancia">
                                                    <mat-card fxFlex="100%" class="cardlote">
                                                        <mat-card-content fxLayout="row wrap">
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <input type="number" matInput autocomplete="off"
                                                                        placeholder="D. entre surcos"
                                                                        formControlName="dsurcos">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <input type="number" matInput autocomplete="off"
                                                                        placeholder="D. entre plantas"
                                                                        formControlName="dplantas">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <input type="text" readonly matInput
                                                                        placeholder="Densidad"
                                                                        formControlName="diastancia">
                                                                </mat-form-field>
                                                            </div>
                                                        </mat-card-content>
                                                    </mat-card>

                                                </ng-container>
                                                <br>
                                                <div fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-card class="cardlote">
                                                        <mat-card-content>
                                                            <mat-slide-toggle formControlName="aplicaplantasinformacli">
                                                                #Plantas/semillas del lote
                                                            </mat-slide-toggle>
                                                        </mat-card-content>
                                                    </mat-card>
                                                </div>
                                                <ng-container *ngIf="lote.value.aplicaplantasinformacli">
                                                    <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                        <mat-form-field>
                                                            <input type="number" matInput placeholder="#plantas"
                                                                id="planatasinformacli{{ac}}-{{lot}}"
                                                                formControlName="planatasinformacli">
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <!-- Ingresos transitorio -->
                                                <ng-container *ngIf="acti.value.nombre.tipoproducto=='Transitorio'">
                                                    <div class="gr" fxFlex="100%" fxFlex.xs="100%">
                                                        <div class="titulo">
                                                            <h3><b>Ingresos</b> </h3>
                                                        </div>
                                                        <mat-chip-list class="chip-titulo">
                                                            <mat-chip color="accent" selected>
                                                                $ {{lote.value.totalIngreso}}
                                                            </mat-chip>
                                                        </mat-chip-list>
                                                    </div>
                                                    <div fxLayout="row wrap" class="contentingresos">
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput
                                                                    placeholder="Rendimiento por lote"
                                                                    formControlName="rendiemientolote">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput
                                                                    placeholder="Unidades totales"
                                                                    id="unidadestotales{{ac}}-{{lot}}"
                                                                    formControlName="unidadestotales">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="% Perdida"
                                                                    id="perdida{{ac}}-{{lot}}"
                                                                    formControlName="perdida">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <mat-label>Última Cosecha</mat-label>
                                                                <mat-select formControlName="proxcocecha" required>
                                                                    <mat-option *ngFor="let mes of meses"
                                                                        [value]="mes.id">
                                                                        {{mes.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <mat-label>Cosecha</mat-label>
                                                                <input type="number" matInput
                                                                    placeholder="Cantidad Meses"
                                                                    formControlName="cantmesescocecha">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="33%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <mat-label>No produccion</mat-label>
                                                                <input type="number" matInput
                                                                    placeholder="Cantidad Meses"
                                                                    formControlName="cantmesesnoproduccion">
                                                            </mat-form-field>
                                                        </div>

                                                    </div>
                                                </ng-container>
                                                <!-- Ingresos permanente -->
                                                <ng-container *ngIf="acti.value.nombre.tipoproducto=='Permanente'">
                                                    <div class="gr" fxFlex="100%" fxFlex.xs="100%">
                                                        <div class="titulo">
                                                            <h3><b>Ingresos</b></h3>
                                                        </div>
                                                        <mat-chip-list class="chip-titulo">
                                                            <mat-chip color="accent" selected>
                                                                $ {{lote.value.totalLoteAunual}}
                                                            </mat-chip>
                                                        </mat-chip-list>
                                                    </div>
                                                    <mat-vertical-stepper linear="true" #stepper>
                                                        <mat-step state="check">
                                                            <div fxLayout="row wrap">
                                                                <ng-template matStepLabel>Cosecha <span
                                                                        class="totalstep">
                                                                        {{lote.value.procentageCos}}
                                                                        %</span>
                                                                </ng-template>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Rendimiento</mat-label>
                                                                        <input matInput type="number"
                                                                            placeholder="Rendimiento"
                                                                            formControlName="rendimientoCos">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Unidades Venta
                                                                        </mat-label>
                                                                        <input matInput type="number"
                                                                            placeholder="Unidades"
                                                                            formControlName="unidadesCos">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field appearance="outline">
                                                                        <mat-label>Perdida</mat-label>
                                                                        <input matInput placeholder="Perdida"
                                                                            type="text" formControlName="perdidaCos"
                                                                            readonly>
                                                                        <mat-icon matSuffix>%</mat-icon>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field appearance="outline">
                                                                        <mat-label>Total Cosecha</mat-label>
                                                                        <input matInput type="text" placeholder="Total"
                                                                            formControlName="totalCos" readonly
                                                                            id="totalCos-{{ac}}-{{lot}}">
                                                                        <mat-icon matSuffix>attach_money</mat-icon>
                                                                    </mat-form-field>
                                                                </div>

                                                                <div>
                                                                    <button mat-button color="primary"
                                                                        matStepperNext>Siguiente</button>
                                                                </div>
                                                            </div>
                                                        </mat-step>
                                                        <mat-step>
                                                            <div fxLayout="row wrap">
                                                                <ng-template matStepLabel>Traviesa <span
                                                                        class="totalstep">
                                                                        {{lote.value.procentageTra}}
                                                                        %</span>
                                                                </ng-template>
                                                                <div class="gr" fxFlex="25%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Rendimiento</mat-label>
                                                                        <input type="tel" matInput
                                                                            placeholder="Rendimiento"
                                                                            formControlName="rendimientoTra">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="25%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Unidades Venta
                                                                        </mat-label>
                                                                        <input type="tel" matInput
                                                                            placeholder="Unidades"
                                                                            formControlName="unidadesTra">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field appearance="outline">
                                                                        <mat-label>Perdida</mat-label>
                                                                        <input type="text" reaonly matInput
                                                                            placeholder="Perdida"
                                                                            formControlName="perdidaTra">
                                                                        <mat-icon matSuffix>%</mat-icon>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field appearance="outline">
                                                                        <mat-label>Total Traviesa</mat-label>
                                                                        <input matInput type="text" placeholder="Total"
                                                                            formControlName="totalTra" readonly
                                                                            id="totalTra-{{ac}}-{{lot}}">
                                                                        <mat-icon matSuffix>attach_money</mat-icon>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div>
                                                                    <button mat-button color="primary"
                                                                        matStepperPrevious>Atras</button>
                                                                    <button mat-button color="primary"
                                                                        matStepperNext>Siguiente</button>
                                                                </div>
                                                            </div>
                                                        </mat-step>
                                                        <mat-step>
                                                            <div fxLayout="row wrap">
                                                                <ng-template matStepLabel>Pepeo <span class="totalstep">
                                                                        {{lote.value.procentagePepeo}} %</span>
                                                                </ng-template>
                                                                <div class="gr" fxFlex="25%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Rendimiento</mat-label>
                                                                        <input matInput type="tel"
                                                                            placeholder="Rendimiento"
                                                                            formControlName="rendimientoPepeo">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="25%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Unidades Venta
                                                                        </mat-label>
                                                                        <input matInput placeholder="Unidades"
                                                                            type="tel" formControlName="unidadesPepeo">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field appearance="outline">
                                                                        <mat-label>Perdida</mat-label>
                                                                        <input matInput placeholder="Perdida"
                                                                            type="text" formControlName="perdidaPepeo"
                                                                            readonly>
                                                                        <mat-icon matSuffix>%</mat-icon>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field appearance="outline">
                                                                        <mat-label>Total Pepeo</mat-label>
                                                                        <input matInput type="text" placeholder="Total"
                                                                            formControlName="totalPepeo" readonly>
                                                                        <mat-icon matSuffix>attach_money</mat-icon>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                        </mat-step>
                                                    </mat-vertical-stepper>
                                                    <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                        <mat-form-field appearance="outline">
                                                            <mat-label>Unidades Totales</mat-label>
                                                            <input matInput type="text" placeholder="Porcentaje"
                                                                formControlName="totalUnidades" readonly
                                                                id="totalUnidades-{{ac}}-{{lot}}">
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <ng-container
                                                    *ngIf="acti.value.nombre.tipoproducto=='Transitorio';then egresotransitorio;else egresopermanente">
                                                </ng-container>
                                                <ng-template #egresotransitorio>
                                                    <div class="titulo">
                                                        <h3><b>Egresos</b></h3>
                                                    </div>
                                                    <mat-chip-list class="chip-titulo">
                                                        <mat-chip color="accent" selected>
                                                            $ {{lote.value.totalEgresos}}
                                                        </mat-chip>
                                                    </mat-chip-list>
                                                    <!-- fase adecuacion -->
                                                    <mat-card class="mat-card-fases">
                                                        <h3>Fase Adecuación</h3>
                                                        <mat-chip-list class="pull-right">
                                                            <mat-chip>
                                                                $ {{lote.value.totalEgresosAdecuacion}}
                                                            </mat-chip>
                                                        </mat-chip-list>
                                                        <mat-card-content>
                                                            <div formArrayName="egresosAdecuacion" class="alternate">
                                                                <div *ngFor="let egreso of egresadosAdecuacion(ac,lot).controls; let eg=index"
                                                                    [formGroupName]="eg" class="content">
                                                                    <div fxLayout="row wrap">
                                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                            fxFlex.sm="35%">
                                                                            <mat-form-field>
                                                                                <mat-label>Descripción</mat-label>
                                                                                <mat-select
                                                                                    formControlName="descripcion"
                                                                                    required>
                                                                                    <mat-option
                                                                                        *ngFor="let det of detalleagri"
                                                                                        [value]="det.id">
                                                                                        {{det.name}}
                                                                                    </mat-option>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                            fxFlex.sm="25%">
                                                                            <mat-form-field>
                                                                                <input type="text" matInput
                                                                                    placeholder="Detalle"
                                                                                    formControlName="detalle">
                                                                            </mat-form-field>
                                                                        </div>

                                                                        <div class="gr" fxFlex="40%" fxFlex.xs="25%"
                                                                            fxFlex.sm="25%">
                                                                            <mat-form-field>
                                                                                <input type="number" matInput
                                                                                    placeholder="Cantidad"
                                                                                    formControlName="cantidad">
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="30%" fxFlex.xs="37%"
                                                                            fxFlex.sm="25%">
                                                                            <mat-form-field>
                                                                                <input type="tel" matInput
                                                                                    placeholder="Valor Unitario"
                                                                                    formControlName="valorunitario">
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="30%" fxFlex.xs="37%"
                                                                            fxFlex.sm="25%">
                                                                            <mat-form-field>
                                                                                <input type="tel" matInput readonly
                                                                                    placeholder="Total"
                                                                                    formControlName="total">
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="100%" fxFlex.xs="100%"
                                                                            fxFlex.sm="35%">
                                                                            <mat-form-field>
                                                                                <mat-label>Mes</mat-label>
                                                                                <mat-select formControlName="mes"
                                                                                    multiple required>
                                                                                    <mat-option
                                                                                        *ngFor="let mes of meses"
                                                                                        [value]="mes.id">
                                                                                        {{mes.name}}
                                                                                    </mat-option>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>

                                                                        <button class="btndelete" color="warn"
                                                                            mat-icon-button [disabled]="eg ==0"
                                                                            (click)="removeEgresosAdecuacion(ac,lot,eg)">
                                                                            <mat-icon>cancel</mat-icon>
                                                                        </button>

                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button mat-fab aria-label="add"
                                                                (click)="addEgresosAdecuacion(ac,lot)" mat-mini-fab
                                                                class="btnadd" type="button" color="accent">
                                                                <mat-icon>add</mat-icon>
                                                            </button>
                                                        </mat-card-content>
                                                    </mat-card>
                                                    <!-- Fase Siembra -->
                                                    <mat-card class="mat-card-fases">
                                                        <h3>Fase Siembra</h3>
                                                        <mat-chip-list class="pull-right">
                                                            <mat-chip>
                                                                $ {{lote.value.totalEgresosSiembre}}
                                                            </mat-chip>
                                                        </mat-chip-list>
                                                        <mat-card-content>
                                                            <div formArrayName="egresosSiembra" class="alternate">
                                                                <div *ngFor="let egreso of egresadosSiembra(ac,lot).controls; let eg=index"
                                                                    [formGroupName]="eg" class="content">
                                                                    <div fxLayout="row wrap">
                                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                            fxFlex.sm="50%">
                                                                            <mat-form-field>
                                                                                <mat-label>Descripción</mat-label>
                                                                                <mat-select
                                                                                    formControlName="descripcion"
                                                                                    required>
                                                                                    <mat-option
                                                                                        *ngFor="let det of detalleagri"
                                                                                        [value]="det.id">
                                                                                        {{det.name}}
                                                                                    </mat-option>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                            fxFlex.sm="50%">
                                                                            <mat-form-field>
                                                                                <input type="text" matInput
                                                                                    placeholder="Detalle"
                                                                                    formControlName="detalle">
                                                                            </mat-form-field>
                                                                        </div>

                                                                        <div class="gr" fxFlex="25%" fxFlex.xs="25%"
                                                                            fxFlex.sm="25%">
                                                                            <mat-form-field>
                                                                                <input type="number" matInput
                                                                                    placeholder="Cantidad"
                                                                                    formControlName="cantidad">
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="37%" fxFlex.xs="37%"
                                                                            fxFlex.sm="37%">
                                                                            <mat-form-field>
                                                                                <input type="tel" matInput
                                                                                    placeholder="Valor Unitario"
                                                                                    formControlName="valorunitario">
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="37%" fxFlex.xs="37%"
                                                                            fxFlex.sm="37%">
                                                                            <mat-form-field>
                                                                                <input type="tel" matInput readonly
                                                                                    placeholder="Total"
                                                                                    formControlName="total">
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <div class="gr" fxFlex="100%" fxFlex.xs="100%"
                                                                            fxFlex.sm="100%">
                                                                            <mat-form-field>
                                                                                <mat-label>Mes</mat-label>
                                                                                <mat-select formControlName="mes"
                                                                                    multiple required>
                                                                                    <mat-option
                                                                                        *ngFor="let mes of meses"
                                                                                        [value]="mes.id">
                                                                                        {{mes.name}}
                                                                                    </mat-option>
                                                                                </mat-select>
                                                                            </mat-form-field>
                                                                        </div>
                                                                        <button type="button" class="btndelete"
                                                                            color="warn" mat-icon-button
                                                                            [disabled]="eg ==0"
                                                                            (click)="removeEgresosSiembra(ac,lot,eg)">
                                                                            <mat-icon>cancel</mat-icon>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <button mat-fab aria-label="add"
                                                                (click)="addEgresosSiembra(ac,lot)" mat-mini-fab
                                                                class="btnadd" type="button" color="accent">
                                                                <mat-icon>add</mat-icon>
                                                            </button>
                                                        </mat-card-content>
                                                    </mat-card>
                                                </ng-template>
                                                <ng-template #egresopermanente>
                                                    <div class="titulo">
                                                        <h3><b>Egresos</b></h3>
                                                    </div>
                                                    <mat-chip-list class="chip-titulo">
                                                        <mat-chip color="accent" selected>
                                                            $ {{lote.value.totalEgresos}}
                                                        </mat-chip>
                                                    </mat-chip-list>
                                                </ng-template>
                                                <!-- fase mantenimiento -->
                                                <mat-card class="mat-card-fases">
                                                    <h3>Fase Mantenimiento</h3>
                                                    <mat-chip-list class="pull-right">
                                                        <mat-chip>
                                                            $ {{lote.value.totalEgresosMante}}
                                                        </mat-chip>
                                                    </mat-chip-list>
                                                    <mat-card-content>
                                                        <div formArrayName="egresosMante" class="alternate">
                                                            <div fxLayout="row wrap"
                                                                *ngFor="let egreso of egresadosMante(ac,lot).controls; let eg=index"
                                                                class="content" [formGroupName]="eg">
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Descripción</mat-label>
                                                                        <mat-select formControlName="descripcion"
                                                                            required>
                                                                            <mat-option *ngFor="let det of detalleagri"
                                                                                [value]="det.id">
                                                                                {{det.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <input type="text" matInput
                                                                            placeholder="Detalle"
                                                                            formControlName="detalle">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="30%" fxFlex.xs="30%"
                                                                    fxFlex.sm="30%">
                                                                    <mat-form-field>
                                                                        <input type="number" matInput
                                                                            placeholder="Cantidad"
                                                                            formControlName="cantidad">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="35%" fxFlex.xs="35%"
                                                                    fxFlex.sm="35%">
                                                                    <mat-form-field>
                                                                        <input type="tel" matInput
                                                                            placeholder="Valor Unitario"
                                                                            formControlName="valorunitario">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="35%" fxFlex.xs="35%"
                                                                    fxFlex.sm="35%">
                                                                    <mat-form-field>
                                                                        <input type="tel" matInput readonly
                                                                            placeholder="Total" formControlName="total">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%"
                                                                    fxFlex.sm="100%">
                                                                    <mat-form-field>
                                                                        <mat-label>Mes</mat-label>
                                                                        <mat-select formControlName="mes" multiple
                                                                            required>
                                                                            <mat-option *ngFor="let mes of meses"
                                                                                [value]="mes.id">
                                                                                {{mes.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                                <button type="button" class="btndelete" color="warn"
                                                                    mat-icon-button [disabled]="eg ==0"
                                                                    (click)="removeEgresosmantenimiento(ac,lot,eg)">
                                                                    <mat-icon>cancel</mat-icon>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <button mat-fab aria-label="add"
                                                            (click)="addEgresosMantenimiento(ac,lot)" mat-mini-fab
                                                            class="btnadd" type="button" color="accent">
                                                            <mat-icon>add</mat-icon>
                                                        </button>
                                                    </mat-card-content>
                                                </mat-card>
                                                <!-- fase Cocecha -->
                                                <mat-card class="mat-card-fases">
                                                    <h3>Fase Cosecha</h3>
                                                    <mat-chip-list class="pull-right">
                                                        <mat-chip>
                                                            $ {{lote.value.totalEgresosCosecha}}
                                                        </mat-chip>
                                                    </mat-chip-list>
                                                    <mat-card-content>
                                                        <div formArrayName="egresosCocecha" class="alternate">
                                                            <div fxLayout="row wrap"
                                                                *ngFor="let egreso of egresadosCocecha(ac,lot).controls; let eg=index"
                                                                class="content" [formGroupName]="eg">

                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Descripción</mat-label>
                                                                        <mat-select formControlName="descripcion"
                                                                            required>
                                                                            <mat-option *ngFor="let det of detalleagri"
                                                                                [value]="det.id">
                                                                                {{det.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <input type="text" matInput
                                                                            placeholder="Detalle"
                                                                            formControlName="detalle">
                                                                    </mat-form-field>
                                                                </div>

                                                                <div class="gr" fxFlex="30%" fxFlex.xs="30%"
                                                                    fxFlex.sm="30%">
                                                                    <mat-form-field>
                                                                        <input type="number" matInput
                                                                            placeholder="Cantidad"
                                                                            formControlName="cantidad">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="35%" fxFlex.xs="35%"
                                                                    fxFlex.sm="35%">
                                                                    <mat-form-field>
                                                                        <input type="tel" matInput
                                                                            placeholder="Valor Unitario"
                                                                            formControlName="valorunitario">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="35%" fxFlex.xs="35%"
                                                                    fxFlex.sm="35%">
                                                                    <mat-form-field>
                                                                        <input type="tel" matInput readonly
                                                                            placeholder="Total" formControlName="total">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%"
                                                                    fxFlex.sm="100%">
                                                                    <mat-form-field>
                                                                        <mat-label>Mes</mat-label>
                                                                        <mat-select formControlName="mes" multiple
                                                                            required>
                                                                            <mat-option *ngFor="let mes of meses"
                                                                                [value]="mes.id">
                                                                                {{mes.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                                <button type="button" class="btndelete" color="warn"
                                                                    mat-icon-button [disabled]="eg ==0"
                                                                    (click)="removeEgresosCosecha(ac,lot,eg)">
                                                                    <mat-icon>cancel</mat-icon>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <button mat-fab aria-label="add"
                                                            (click)="addEgresosCocecho(ac,lot)" mat-mini-fab
                                                            class="btnadd" type="button" color="accent">
                                                            <mat-icon>add</mat-icon>
                                                        </button>
                                                    </mat-card-content>
                                                </mat-card>
                                            </div>
                                        </mat-expansion-panel>
                                    </mat-accordion>
                                </div>
                            </ng-container>
                            <!-- pecuario -->
                            <ng-container *ngSwitchCase="2">
                                <!-- Lotes pecuario -->
                                <div formArrayName="lotesPecuario">
                                    <mat-accordion class="example-headers-align" multi>
                                        <mat-expansion-panel
                                            *ngFor="let lote of lotesPecuario(ac).controls; let lot=index"
                                            [formGroupName]="lot">
                                            <mat-expansion-panel-header>
                                                <mat-panel-title>
                                                    Lote
                                                </mat-panel-title>
                                                <mat-panel-description fxLayout="row">
                                                    <span *ngIf="lot>0"># {{lot}}</span> <span
                                                        *ngIf="lot==0">Principal</span>
                                                    <mat-icon>pets</mat-icon>
                                                    <button (click)="removeLotesPecuario(ac,lot)" [disabled]="lot==0"
                                                        color="warn" mat-icon-button type="button">
                                                        <mat-icon>cancel</mat-icon>
                                                    </button>
                                                </mat-panel-description>
                                            </mat-expansion-panel-header>
                                            <!-- Ingresos -->
                                            <div fxLayout="row wrap">
                                                <mat-card class="mat-card-fases">
                                                    <mat-card-header>
                                                        <mat-card-title>Ingresos</mat-card-title>
                                                        <mat-chip-list class="pull-right">
                                                            <mat-chip color="accent" selected>
                                                                $ {{lote.value.ingresomes}}
                                                            </mat-chip>
                                                        </mat-chip-list>
                                                    </mat-card-header>
                                                    <mat-card-content>
                                                        <div fxLayout="row wrap">
                                                            <div class="gr" fxFlex="30%" fxFlex.xs="60%"
                                                                fxFlex.sm="60%">
                                                                <mat-form-field>
                                                                    <input type="text" matInput
                                                                        placeholder="Producto derivado"
                                                                        formControlName="prodderivado">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="20%" fxFlex.xs="40%"
                                                                fxFlex.sm="40%">
                                                                <mat-form-field>
                                                                    <input type="number" matInput
                                                                        placeholder="N° animales" autocomplete="off"
                                                                        formControlName="numanimales">
                                                                </mat-form-field>
                                                            </div>

                                                            <div class="gr" fxFlex="20%" fxFlex.xs="40%"
                                                                fxFlex.sm="40%">
                                                                <mat-form-field>
                                                                    <mat-label>Cantidad
                                                                        <ng-container *ngIf="acti.value.unidadventa">
                                                                            {{acti.value.unidadventa.name}}
                                                                        </ng-container>
                                                                    </mat-label>
                                                                    <input type="number" autocomplete="off" matInput
                                                                        placeholder="Por animal"
                                                                        formControlName="cantidadxanimal">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="30%" fxFlex.xs="60%"
                                                                fxFlex.sm="60%">
                                                                <mat-form-field>
                                                                    <mat-label>Frecuencia</mat-label>
                                                                    <mat-select formControlName="frecuencia"
                                                                        id="frecuencia{{ac}}-{{lot}}" required>
                                                                        <mat-option>-Seleccione-</mat-option>
                                                                        <mat-option *ngFor="let fre of frecuencia"
                                                                            [value]="fre">
                                                                            {{fre.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <mat-label>
                                                                        <ng-container *ngIf="acti.value.unidadventa">
                                                                            {{acti.value.unidadventa.name}}
                                                                        </ng-container>
                                                                        Producidas
                                                                    </mat-label>
                                                                    <input type="tel" matInput placeholder="Cantidad"
                                                                        readonly formControlName="cantproducida">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <input type="tel" matInput
                                                                        placeholder="Uni Total ventas"
                                                                        formControlName="unitotalesventa">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <input type="text" matInput
                                                                        placeholder="% Mortalidad" readonly
                                                                        id="perdida{{ac}}-{{lot}}"
                                                                        formControlName="perdida">
                                                                </mat-form-field>
                                                            </div>

                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <mat-label>Último ciclo</mat-label>
                                                                    <mat-select formControlName="mesingreso"
                                                                        (selectionChange)="changeMes($event)" required>
                                                                        <mat-option *ngFor="let mes of meses"
                                                                            [value]="mes.id">
                                                                            {{mes.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <mat-label>Producción</mat-label>
                                                                    <input type="number" matInput autocomplete="off"
                                                                        placeholder="Cantidad de meses"
                                                                        formControlName="produccion">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%"
                                                                fxFlex.sm="33%">
                                                                <mat-form-field>
                                                                    <mat-label>No Producción</mat-label>
                                                                    <input type="number" matInput
                                                                        placeholder="Cantidad de meses"
                                                                        formControlName="noproduccion">
                                                                </mat-form-field>
                                                            </div>
                                                        </div>
                                                    </mat-card-content>
                                                </mat-card>
                                                <!-- Egresos  -->
                                                <mat-card class="mat-card-fases">
                                                    <mat-card-header>
                                                        <mat-card-title>Egresos</mat-card-title>
                                                        <mat-chip-list class="pull-right">
                                                            <mat-chip color="accent" selected>
                                                                $ {{lote.value.totalEgresos}}
                                                            </mat-chip>
                                                        </mat-chip-list>
                                                    </mat-card-header>
                                                    <mat-card-content>
                                                        <div formArrayName="egresos" class="alternate">
                                                            <div fxLayout="row wrap"
                                                                *ngFor="let egreso of egresosPecuario(ac,lot).controls; let eg=index"
                                                                class="content" [formGroupName]="eg">
                                                                <button type="button" class="btndelete" color="warn"
                                                                    mat-icon-button [disabled]="eg ==0"
                                                                    (click)="removeEgresos(ac,lot,eg)">
                                                                    <mat-icon>cancel</mat-icon>
                                                                </button>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <mat-label>Descripcion</mat-label>
                                                                        <mat-select formControlName="descripcion"
                                                                            required>
                                                                            <mat-option *ngFor="let det of detallepecu"
                                                                                [value]="det.id">
                                                                                {{det.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                    fxFlex.sm="50%">
                                                                    <mat-form-field>
                                                                        <input type="text" matInput
                                                                            placeholder="Detalle"
                                                                            formControlName="detalle">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="20%" fxFlex.xs="20%"
                                                                    fxFlex.sm="20%">
                                                                    <mat-form-field>
                                                                        <input type="number" matInput
                                                                            placeholder="Cantidad"
                                                                            formControlName="cantidad">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="40%" fxFlex.xs="40%"
                                                                    fxFlex.sm="40%">
                                                                    <mat-form-field>
                                                                        <input type="tel" matInput
                                                                            placeholder="Valor Unitario"
                                                                            formControlName="valorunitario">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="40%" fxFlex.xs="40%"
                                                                    fxFlex.sm="40%">
                                                                    <mat-form-field>
                                                                        <input type="tel" matInput placeholder="Total"
                                                                            formControlName="total">
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%"
                                                                    fxFlex.sm="100%">
                                                                    <mat-form-field>
                                                                        <mat-label>Mes</mat-label>
                                                                        <mat-select formControlName="mes" multiple
                                                                            required>
                                                                            <mat-option *ngFor="let mes of meses"
                                                                                [value]="mes.id">
                                                                                {{mes.name}}
                                                                            </mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <button mat-fab aria-label="add" (click)="addEgresos(ac,lot)"
                                                            mat-mini-fab class="btnadd" type="button" color="accent">
                                                            <mat-icon>add</mat-icon>
                                                        </button>
                                                    </mat-card-content>
                                                </mat-card>
                                            </div>
                                        </mat-expansion-panel>
                                    </mat-accordion>
                                </div>
                            </ng-container>
                            <!-- otras actividades -->
                            <ng-container *ngSwitchCase="3">

                                <mat-card>
                                    <mat-card-header>
                                        <mat-card-title>Ventas <mat-icon>account_balance</mat-icon>
                                        </mat-card-title>
                                        <mat-card-subtitle> Cruces</mat-card-subtitle>
                                    </mat-card-header>

                                    <mat-card-content>
                                        <!-- ventas b r m  -->
                                        <div fxLayout="row wrap">
                                            <mat-card class="radioperiodo">
                                                <mat-card-content>
                                                    <mat-radio-group fxLayout="row wrap" (change)="changePeriodo(acti)"
                                                        formControlName="periodoventas">
                                                        <mat-radio-button fxFlex="40%" fxFlex.xs="25%" value="1">Dia
                                                        </mat-radio-button>
                                                        <mat-radio-button fxFlex="35%" fxFlex.xs="35%" value="2">Semana
                                                        </mat-radio-button>
                                                        <mat-radio-button fxFlex="25%" fxFlex.xs="40%" value="3">
                                                            Quincena
                                                        </mat-radio-button>
                                                    </mat-radio-group>
                                                </mat-card-content>
                                            </mat-card>
                                            <ng-container *ngIf="acti.value.periodoventas">
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <ng-container [ngSwitch]="acti.value.periodoventas">
                                                        <ng-container *ngSwitchCase="1">
                                                            <mat-form-field>
                                                                <mat-label>Buenas</mat-label>
                                                                <mat-select formControlName="diasB" multiple>
                                                                    <mat-option *ngFor="let d of diasSemana"
                                                                        [value]="d.id"
                                                                        [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="2">
                                                            <mat-form-field>
                                                                <mat-label>Buenas</mat-label>
                                                                <mat-select formControlName="diasB" multiple>
                                                                    <mat-option *ngFor="let d of semanas" [value]="d.id"
                                                                        [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="3">
                                                            <mat-form-field>
                                                                <mat-label>Buenas</mat-label>
                                                                <mat-select formControlName="diasB" multiple>
                                                                    <mat-option *ngFor="let d of quincena"
                                                                        [value]="d.id"
                                                                        [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>

                                                    </ng-container>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="tel" matInput placeholder="Valor Buenas"
                                                            id="valorB{{ac}}" formControlName="valorB">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="text" readonly matInput placeholder="Total"
                                                            id="totalB{{ac}}" formControlName="totalB">
                                                    </mat-form-field>
                                                </div>
                                                <ng-container *ngIf="acti.value.periodoventas !=3">
                                                    <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                        <ng-container [ngSwitch]="acti.value.periodoventas">
                                                            <ng-container *ngSwitchCase="1">
                                                                <mat-form-field>
                                                                    <mat-label>Regulares</mat-label>
                                                                    <mat-select formControlName="diasR" multiple>
                                                                        <mat-option *ngFor="let d of diasSemana"
                                                                            [value]="d.id"
                                                                            [disabled]="acti.value.diasB.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                            {{d.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </ng-container>
                                                            <ng-container *ngSwitchCase="2">
                                                                <mat-form-field>
                                                                    <mat-label>Regulares</mat-label>
                                                                    <mat-select formControlName="diasR" multiple>
                                                                        <mat-option *ngFor="let d of semanas"
                                                                            [value]="d.id"
                                                                            [disabled]="acti.value.diasB.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                            {{d.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </ng-container>
                                                            <ng-container *ngSwitchCase="3">
                                                                <mat-form-field>
                                                                    <mat-label>Regulares</mat-label>
                                                                    <mat-select formControlName="diasR" multiple>
                                                                        <mat-option *ngFor="let d of quincena"
                                                                            [value]="d.id"
                                                                            [disabled]="acti.value.diasB.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                            {{d.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </ng-container>

                                                        </ng-container>
                                                    </div>
                                                    <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                        <mat-form-field>
                                                            <input type="tel" matInput placeholder="Valor Regulares"
                                                                id="valorR{{ac}}" formControlName="valorR">
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                        <mat-form-field>
                                                            <input type="text" readonly matInput placeholder="Total"
                                                                id="totalR{{ac}}" formControlName="totalR">
                                                        </mat-form-field>
                                                    </div>
                                                </ng-container>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <ng-container [ngSwitch]="acti.value.periodoventas">
                                                        <ng-container *ngSwitchCase="1">
                                                            <mat-form-field>
                                                                <mat-label>Malas</mat-label>
                                                                <mat-select formControlName="diasM" multiple>
                                                                    <mat-option *ngFor="let d of diasSemana"
                                                                        [value]="d.id"
                                                                        [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasB.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="2">
                                                            <mat-form-field>
                                                                <mat-label>Malas</mat-label>
                                                                <mat-select formControlName="diasM" multiple>
                                                                    <mat-option *ngFor="let d of semanas" [value]="d.id"
                                                                        [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasB.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="3">
                                                            <mat-form-field>
                                                                <mat-label>Malas</mat-label>
                                                                <mat-select formControlName="diasM" multiple>
                                                                    <mat-option *ngFor="let d of quincena"
                                                                        [value]="d.id"
                                                                        [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasB.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>

                                                    </ng-container>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="tel" matInput placeholder="Valor Malas"
                                                            id="valorM{{ac}}" formControlName="valorM">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="text" readonly matInput placeholder="Total"
                                                            id="totalM{{ac}}" formControlName="totalM">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-form-field>
                                                        <input type="text" readonly matInput placeholder="Total"
                                                            formControlName="totalVentas">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="43%" fxFlex.sm="40%">
                                                    <mat-form-field appearance="outline">
                                                        <mat-label>Promedio</mat-label>
                                                        <input matInput type="text" readonly id="promedio{{ac}}"
                                                            formControlName="promedio">
                                                        <mat-icon matSuffix>attach_money</mat-icon>
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="27%" fxFlex.sm="20%">
                                                    <mat-form-field appearance="outline">
                                                        <mat-label>Dias</mat-label>
                                                        <input matInput type="number" matInput placeholder="Dias"
                                                            id="totalDias{{ac}}" formControlName="totalDias">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="30%" fxFlex.sm="40%">
                                                    <mat-form-field appearance="outline">
                                                        <mat-label>Total Promedio</mat-label>
                                                        <input type="text" readonly matInput
                                                            placeholder="Total Promedio" id="totalPromedio{{ac}}"
                                                            formControlName="totalPromedio">
                                                        <mat-icon matSuffix>attach_money</mat-icon>
                                                    </mat-form-field>
                                                </div>
                                            </ng-container>
                                        </div>
                                    </mat-card-content>
                                </mat-card>

                                <mat-card>
                                    <mat-card-header>
                                        <mat-card-title>Resumen Ingreso</mat-card-title>
                                    </mat-card-header>
                                    <mat-card-content>
                                        <div fxLayout="row wrap">

                                            <div class="gr" fxFlex="25%" fxFlex.xs="50%" fxFlex.sm="45%">
                                                <mat-form-field>
                                                    <input type="tel" autocomplete="off" matInput
                                                        placeholder="Total Compras" required
                                                        formControlName="totalCompras">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="25%" fxFlex.xs="50%" fxFlex.sm="45%">
                                                <mat-form-field>
                                                    <input type="tel" autocomplete="off" matInput readonly
                                                        placeholder="Ventas Estimadas" required
                                                        formControlName="ventasEstimadas">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="25%" fxFlex.xs="50%" fxFlex.sm="45%">
                                                <mat-form-field>
                                                    <input type="tel" autocomplete="off" matInput
                                                        placeholder="Margen Bruto" required
                                                        formControlName="margenBruto">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="25%" fxFlex.xs="50%" fxFlex.sm="45%">
                                                <mat-form-field>
                                                    <input type="tel" autocomplete="off" matInput
                                                        placeholder="Otros Gastos" required
                                                        formControlName="otrosGastos">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Ingreso Liquido</mat-label>
                                                    <input matInput type="text" readonly id="ingresoLiquido{{ac}}"
                                                        formControlName="ingresoLiquido">
                                                    <mat-icon matSuffix>attach_money</mat-icon>
                                                </mat-form-field>
                                            </div>
                                        </div>
                                    </mat-card-content>
                                </mat-card>
                            </ng-container>
                        </ng-container>
                    </div>
                </mat-tab>
            </div>
        </mat-tab-group>
    </form>
</ng-container>