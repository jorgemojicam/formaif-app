<ng-template #loading>
    <div class="container-spinner">
        <mat-spinner></mat-spinner>
    </div>
</ng-template>
<ng-container *ngIf="loadData; else loading">
    <form [formGroup]="actividadesForm">

        <button mat-mini-fab type="button" class="addact" [disabled]="actividades().controls.length>=6" color="primary"
            (click)="addActividad()">
            <mat-icon>add</mat-icon>
        </button>
        <mat-tab-group mat-align-tabs="start" [selectedIndex]="selected.value"
            (selectedIndexChange)="selected.setValue($event)">
            <div formArrayName="act" fxFlex="100%">

                <mat-tab *ngFor="let acti of actividades().controls; let ac=index">
                    <ng-template mat-tab-label>
                        <ng-container *ngIf="ac==0">Principal</ng-container>
                        <ng-container *ngIf="ac>0">Act {{ac + 1}}</ng-container>
                    </ng-template>
                    <div [formGroupName]="ac">
                        <!-- encavezado -->
                        <mat-card class="encabezado">
                            <mat-card-content>
                                <div fxLayout="row wrap">
                                    <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                        <mat-form-field>
                                            <input type="text" autocomplete="off" matInput placeholder="Actividad"
                                                id="nombre{{ac}}" formControlName="nombre">
                                        </mat-form-field>
                                    </div>
                                    <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                        <mat-form-field>
                                            <mat-label>Tipo Actividad</mat-label>
                                            <mat-select formControlName="tipo" required>
                                                <mat-option>--</mat-option>
                                                <mat-option *ngFor="let tip of tipoAct" [value]="tip.id">
                                                    {{tip.name}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                    <button class="deleteact" color="warn" mat-icon-button [disabled]="ac==0"
                                        (click)="deleteAct(ac)">
                                        <mat-icon>cancel</mat-icon>
                                    </button>
                                </div>
                            </mat-card-content>
                        </mat-card>

                        <ng-container *ngIf="acti.value.tipo">

                            <mat-accordion class="example-headers-align" multi>
                                <!-- cruce 1 -->
                                <mat-expansion-panel *ngIf="acti.value.tipo !=4">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                            Cruce #1
                                        </mat-panel-title>
                                        <mat-panel-description>
                                            {{acti.value.totalCruce1 | currency:'$': 'symbol' : '1.0-0'}}
                                            <mat-icon>account_balance</mat-icon>
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>
                                    <!-- ventas b r m  -->
                                    <div fxLayout="row wrap">
                                        <mat-card class="radioperiodo">
                                            <mat-card-content>
                                                <mat-radio-group fxLayout="row wrap" (change)="changePeriodo(acti)"
                                                    formControlName="periodoventas">
                                                    <mat-radio-button fxFlex="40%" fxFlex.xs="25%" value="1">Dia
                                                    </mat-radio-button>
                                                    <mat-radio-button fxFlex="35%" fxFlex.xs="35%" value="2">Semana
                                                    </mat-radio-button>
                                                    <mat-radio-button fxFlex="25%" fxFlex.xs="40%" value="3">Quincena
                                                    </mat-radio-button>
                                                </mat-radio-group>
                                            </mat-card-content>
                                        </mat-card>
                                        <ng-container *ngIf="acti.value.periodoventas">
                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                <ng-container [ngSwitch]="acti.value.periodoventas">
                                                    <ng-container *ngSwitchCase="1">
                                                        <mat-form-field>
                                                            <mat-label>Buenas</mat-label>
                                                            <mat-select formControlName="diasB" multiple>
                                                                <mat-option *ngFor="let d of diasSemana" [value]="d.id"
                                                                    [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                    {{d.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="2">
                                                        <mat-form-field>
                                                            <mat-label>Buenas</mat-label>
                                                            <mat-select formControlName="diasB" multiple>
                                                                <mat-option *ngFor="let d of semanas" [value]="d.id"
                                                                    [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                    {{d.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="3">
                                                        <mat-form-field>
                                                            <mat-label>Buenas</mat-label>
                                                            <mat-select formControlName="diasB" multiple>
                                                                <mat-option *ngFor="let d of quincena" [value]="d.id"
                                                                    [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                    {{d.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </ng-container>

                                                </ng-container>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                <mat-form-field>
                                                    <input type="tel" matInput placeholder="Valor Buenas"
                                                        id="valorB{{ac}}" formControlName="valorB">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                <mat-form-field>
                                                    <input type="text" readonly matInput placeholder="Total"
                                                        id="totalB{{ac}}" formControlName="totalB">
                                                </mat-form-field>
                                            </div>
                                            <ng-container *ngIf="acti.value.periodoventas !=3">
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <ng-container [ngSwitch]="acti.value.periodoventas">
                                                        <ng-container *ngSwitchCase="1">
                                                            <mat-form-field>
                                                                <mat-label>Regulares</mat-label>
                                                                <mat-select formControlName="diasR" multiple>
                                                                    <mat-option *ngFor="let d of diasSemana"
                                                                        [value]="d.id"
                                                                        [disabled]="acti.value.diasB.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="2">
                                                            <mat-form-field>
                                                                <mat-label>Regulares</mat-label>
                                                                <mat-select formControlName="diasR" multiple>
                                                                    <mat-option *ngFor="let d of semanas" [value]="d.id"
                                                                        [disabled]="acti.value.diasB.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>
                                                        <ng-container *ngSwitchCase="3">
                                                            <mat-form-field>
                                                                <mat-label>Regulares</mat-label>
                                                                <mat-select formControlName="diasR" multiple>
                                                                    <mat-option *ngFor="let d of quincena"
                                                                        [value]="d.id"
                                                                        [disabled]="acti.value.diasB.indexOf(d.id) >= 0 || acti.value.diasM.indexOf(d.id) >= 0">
                                                                        {{d.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </ng-container>

                                                    </ng-container>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="tel" matInput placeholder="Valor Regulares"
                                                            id="valorR{{ac}}" formControlName="valorR">
                                                    </mat-form-field>
                                                </div>
                                                <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                    <mat-form-field>
                                                        <input type="text" readonly matInput placeholder="Total"
                                                            id="totalR{{ac}}" formControlName="totalR">
                                                    </mat-form-field>
                                                </div>
                                            </ng-container>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                <ng-container [ngSwitch]="acti.value.periodoventas">
                                                    <ng-container *ngSwitchCase="1">
                                                        <mat-form-field>
                                                            <mat-label>Malas</mat-label>
                                                            <mat-select formControlName="diasM" multiple>
                                                                <mat-option *ngFor="let d of diasSemana" [value]="d.id"
                                                                    [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasB.indexOf(d.id) >= 0">
                                                                    {{d.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="2">
                                                        <mat-form-field>
                                                            <mat-label>Malas</mat-label>
                                                            <mat-select formControlName="diasM" multiple>
                                                                <mat-option *ngFor="let d of semanas" [value]="d.id"
                                                                    [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasB.indexOf(d.id) >= 0">
                                                                    {{d.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </ng-container>
                                                    <ng-container *ngSwitchCase="3">
                                                        <mat-form-field>
                                                            <mat-label>Malas</mat-label>
                                                            <mat-select formControlName="diasM" multiple>
                                                                <mat-option *ngFor="let d of quincena" [value]="d.id"
                                                                    [disabled]="acti.value.diasR.indexOf(d.id) >= 0 || acti.value.diasB.indexOf(d.id) >= 0">
                                                                    {{d.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </ng-container>

                                                </ng-container>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                <mat-form-field>
                                                    <input type="tel" matInput placeholder="Valor Malas"
                                                        id="valorM{{ac}}" formControlName="valorM">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="33%" fxFlex.sm="33%">
                                                <mat-form-field>
                                                    <input type="text" readonly matInput placeholder="Total"
                                                        id="totalM{{ac}}" formControlName="totalM">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                <mat-form-field>
                                                    <input type="text" readonly matInput placeholder="Total"
                                                        formControlName="totalVentas">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="43%" fxFlex.sm="40%">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Promedio</mat-label>
                                                    <input matInput type="text" readonly id="promedio{{ac}}"
                                                        formControlName="promedio">
                                                    <mat-icon matSuffix>attach_money</mat-icon>
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="27%" fxFlex.sm="20%">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Dias</mat-label>
                                                    <input matInput type="number" matInput placeholder="Dias"
                                                        id="totalDias{{ac}}" formControlName="totalDias">
                                                </mat-form-field>
                                            </div>
                                            <div class="gr" fxFlex="33%" fxFlex.xs="30%" fxFlex.sm="40%">
                                                <mat-form-field appearance="outline">
                                                    <mat-label>Total Promedio</mat-label>
                                                    <input type="text" readonly matInput placeholder="Total Promedio"
                                                        id="totalPromedio{{ac}}" formControlName="totalPromedio">
                                                    <mat-icon matSuffix>attach_money</mat-icon>
                                                </mat-form-field>
                                            </div>
                                        </ng-container>
                                    </div>
                                </mat-expansion-panel>
                                <!-- cruce 2 -->
                                <mat-expansion-panel *ngIf="acti.value.tipo !=4">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                            Cruce #2
                                        </mat-panel-title>
                                        <mat-panel-description>
                                            {{acti.value.totalCruce2 | currency:'$': 'symbol' : '1.0-0'}}
                                            <mat-icon>attach_money</mat-icon>
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>
                                    <!-- ventas historicas -->
                                    <mat-card class="mat-card-cruce">
                                        <mat-card-header>
                                            <mat-card-title>Ventas Historicas</mat-card-title>
                                            <mat-chip-list class="pull-right">
                                                <mat-chip color="accent" matTooltip="Total promedio mensual"
                                                    matTooltipPosition="below" selected>{{acti.value.promtotalvenHis|
                                                    currency:'$': 'symbol' : '1.0-0'}}
                                                </mat-chip>
                                            </mat-chip-list>
                                        </mat-card-header>
                                        <mat-card-content>
                                            <div fxLayout="row wrap">
                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-form-field>
                                                        <mat-label>Frecuencia</mat-label>
                                                        <mat-select formControlName="periodohistoricas" required
                                                            (selectionChange)="loadVentas(ac,$event)">
                                                            <mat-option *ngFor="let fre of frecuencia" [value]="fre">
                                                                {{fre.name}}
                                                            </mat-option>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </div>
                                                <div formArrayName="ventasHis" class="alternate" fxFlex="100%"
                                                    fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <div *ngFor="let vent of ventashistoricas(ac).controls; let ven=index"
                                                        [formGroupName]="ven" class="content">
                                                        <ng-container *ngIf="acti.value.periodohistoricas != null">
                                                            <div class="gr" fxFlex="50%" fxFlex.xs="25%"
                                                                fxFlex.sm="25%">
                                                                <mat-form-field>
                                                                    <input type="text" matInput
                                                                        placeholder="{{acti.value.periodohistoricas.name}}"
                                                                        id="dia{{ven}}" formControlName="dia" readonly>
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="60%" fxFlex.xs="70%"
                                                                fxFlex.sm="45%">
                                                                <mat-form-field>
                                                                    <input type="tel" autocomplete="off" matInput
                                                                        placeholder="Valor" required id="valor{{ven}}"
                                                                        formControlName="valor">
                                                                </mat-form-field>
                                                            </div>
                                                            <button class="btndelete" color="warn" mat-icon-button
                                                                [disabled]="ven==0 || acti.value.periodohistoricas.id==1 
                                                                || (acti.value.periodohistoricas.id==2 && ven < 3)
                                                                || (acti.value.periodohistoricas.id==3 && ven < 2)
                                                                || (acti.value.periodohistoricas.id==4 && ven < 3)"
                                                                (click)="removeVentas(ac,ven)">
                                                                <mat-icon>cancel</mat-icon>
                                                            </button>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                                <div fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-form-field appearance="outline">
                                                        <mat-label>Promedio</mat-label>
                                                        <input matInput type="text" readonly
                                                            formControlName="totalVentasHis" id="totalVentasHis{{ac}}">
                                                        <mat-icon matSuffix>attach_money</mat-icon>
                                                    </mat-form-field>
                                                </div>
                                            </div>
                                        </mat-card-content>
                                        <ng-container *ngIf="acti.value.periodohistoricas != null">
                                            <button mat-fab aria-label="add" mat-mini-fab class="btnadd" type="button"
                                                color="accent" (click)="addVentashis(ac)" [disabled]="ventashistoricas(ac).length >= acti.value.periodohistoricas.cant
                                            || acti.value.periodohistoricas.id==1 ">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </ng-container>
                                    </mat-card>
                                    <br>
                                    <!-- produccion -->
                                    <ng-container *ngIf="acti.value.tipo==2">
                                        <mat-card class="mat-card-cruce">
                                            <mat-card-header>
                                                <mat-card-title>Produccion</mat-card-title>
                                                <mat-chip-list class="pull-right">
                                                    <mat-chip color="accent" selected>
                                                        {{acti.value.totalProduccion|currency:"$":'symbol':'1.0-0'}}
                                                    </mat-chip>
                                                </mat-chip-list>
                                            </mat-card-header>
                                            <mat-card-content>
                                                <div formArrayName="produccion" class="alternate">
                                                    <div *ngFor="let prod  of produccion(ac).controls; let pro=index"
                                                        [formGroupName]="pro" class="content">
                                                        <div fxLayout="row wrap">
                                                            <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                fxFlex.sm="50%">
                                                                <mat-form-field>
                                                                    <input type="text" matInput placeholder="Nombre"
                                                                        id="nombre-{{ac}}-{{pro}}"
                                                                        formControlName="nombre">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="15%" fxFlex.xs="15%"
                                                                fxFlex.sm="15%">
                                                                <mat-form-field>
                                                                    <input type="number" matInput placeholder="Cantidad"
                                                                        id="cantidad-{{ac}}-{{pro}}"
                                                                        formControlName="cantidad">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="32%" fxFlex.xs="32%"
                                                                fxFlex.sm="32%">
                                                                <mat-form-field>
                                                                    <input type="tel" matInput placeholder="Precio"
                                                                        id="valor-{{ac}}-{{pro}}"
                                                                        formControlName="valor">
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                fxFlex.sm="50%">
                                                                <mat-form-field>
                                                                    <mat-label>Frecuencia</mat-label>
                                                                    <mat-select formControlName="frecuencia"
                                                                        id="frecuencia-{{ac}}-{{pro}}" required>
                                                                        <mat-option>--</mat-option>
                                                                        <mat-option *ngFor="let frec of frecuencia"
                                                                            [value]="frec">
                                                                            {{frec.name}}
                                                                        </mat-option>
                                                                    </mat-select>
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="gr" fxFlex="50%" fxFlex.xs="50%"
                                                                fxFlex.sm="50%">
                                                                <mat-form-field>
                                                                    <input type="tel" matInput placeholder="Total"
                                                                        id="total-{{ac}}-{{pro}}" readonly
                                                                        formControlName="total">
                                                                </mat-form-field>
                                                            </div>
                                                            <button class="btndelete" color="warn" mat-icon-button
                                                                [disabled]="pro==0" (click)="removeProduccion(ac,pro)">
                                                                <mat-icon>cancel</mat-icon>
                                                            </button>

                                                        </div>
                                                    </div>
                                                </div>
                                            </mat-card-content>

                                            <button mat-fab aria-label="add" mat-mini-fab class="btnadd" type="button"
                                                color="accent" (click)="addProduccion(ac)"
                                                [disabled]="produccion(ac).length >= 5">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </mat-card>
                                    </ng-container>
                                </mat-expansion-panel>
                                <!-- cruce 3  -->
                                <mat-expansion-panel>
                                    <mat-expansion-panel-header>
                                        <mat-panel-title>
                                            Cruce #3
                                        </mat-panel-title>
                                        <mat-panel-description>
                                            {{acti.value.totalCruce3| currency:'$': 'symbol' : '1.0-0'}}
                                            <mat-icon>add_shopping_cart</mat-icon>
                                        </mat-panel-description>
                                    </mat-expansion-panel-header>
                                    <ng-container *ngIf="acti.value.tipo==2">
                                        <!-- Materia prima -->
                                        <mat-card class="mat-card-cruce">
                                            <mat-card-header>
                                                <mat-card-title>Costo de venta</mat-card-title>
                                                <mat-chip-list>
                                                    <mat-chip color="primary" selected matTooltip="Margen"
                                                        matTooltipPosition="below">
                                                        {{acti.value.margen}} %</mat-chip>
                                                    <mat-chip color="accent" selected matTooltip="Costo"
                                                        matTooltipPosition="below">
                                                        {{acti.value.costo}} %</mat-chip>
                                                </mat-chip-list>
                                            </mat-card-header>
                                            <mat-card-content>
                                                <div formArrayName="materiaprima" class="alternate">
                                                    <div *ngFor="let prod of materiaprima(ac).controls; let mat=index"
                                                        [formGroupName]="mat" class="content" fxLayout="row wrap">

                                                        <div class="gr" fxFlex="42%" fxFlex.xs="42%" fxFlex.sm="42%">
                                                            <mat-form-field>
                                                                <input type="text" matInput placeholder="Producto"
                                                                    id="producto{{ac}}-{{mat}}"
                                                                    formControlName="producto">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="22%" fxFlex.xs="22%" fxFlex.sm="22%">
                                                            <mat-form-field>
                                                                <input type="number" matInput placeholder="Cantidad"
                                                                    id="cantidad{{mat}}" formControlName="cantidad">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="32%" fxFlex.xs="32%" fxFlex.sm="32%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Precio Venta"
                                                                    id="precioVenProd{{mat}}"
                                                                    formControlName="precioVenProd">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="70%" fxFlex.xs="70%" fxFlex.sm="70%">
                                                            <mat-form-field>
                                                                <input type="text" matInput
                                                                    placeholder="Materia Prima principal"
                                                                    id="materiaprimapri{{mat}}"
                                                                    formControlName="materiaprimapri">
                                                            </mat-form-field>
                                                        </div>

                                                        <div class="gr" fxFlex="25%" fxFlex.xs="25%" fxFlex.sm="25%">
                                                            <mat-form-field>
                                                                <input type="number" matInput placeholder="Cantidad"
                                                                    id="cantMatPri{{mat}}" formControlName="cantMatPri">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <mat-label>Unidad Venta</mat-label>
                                                                <mat-select formControlName="unidad"
                                                                    id="unidad{{ac}}-{{mat}}" required>
                                                                    <mat-option>--</mat-option>
                                                                    <mat-option *ngFor="let un of unidades"
                                                                        [value]="un">
                                                                        {{un.name}}
                                                                    </mat-option>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="47%" fxFlex.xs="47%" fxFlex.sm="47%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor Total"
                                                                    id="valorMatPri{{mat}}"
                                                                    formControlName="valorMatPri">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" matInput
                                                                    placeholder="Materia Prima 2" id="matPrima2{{mat}}"
                                                                    formControlName="matPrima2">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor"
                                                                    id="valorMatPri2{{mat}}"
                                                                    formControlName="valorMatPri2">
                                                            </mat-form-field>
                                                        </div>

                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" matInput
                                                                    placeholder="Materia Prima 3" id="matPrima3{{mat}}"
                                                                    formControlName="matPrima3">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor"
                                                                    id="valorMatPri3{{mat}}"
                                                                    formControlName="valorMatPri3">
                                                            </mat-form-field>
                                                        </div>

                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" matInput
                                                                    placeholder="Materia Prima 4" id="matPrima4{{mat}}"
                                                                    formControlName="matPrima4">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor"
                                                                    id="valorMatPri4{{mat}}"
                                                                    formControlName="valorMatPri4">
                                                            </mat-form-field>
                                                        </div>

                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" matInput
                                                                    placeholder="Materia Prima 5" id="matPrima5{{mat}}"
                                                                    formControlName="matPrima5">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor"
                                                                    id="valorMatPri5{{mat}}"
                                                                    formControlName="valorMatPri5">
                                                            </mat-form-field>
                                                        </div>

                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" readonly matInput
                                                                    value="Mano de Obra" id="ManoObra{{mat}}"
                                                                    formControlName="ManoObra">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor"
                                                                    id="valorMao{{mat}}" formControlName="valorMao">
                                                            </mat-form-field>
                                                        </div>

                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" readonly matInput id="cif{{mat}}"
                                                                    value="CIF" formControlName="cif">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="tel" matInput placeholder="Valor"
                                                                    id="valorCif{{mat}}" formControlName="valorCif">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Precio Compra</mat-label>
                                                                <input type="text" matInput placeholder="Precio Compra"
                                                                    id="precioCompraMat{{ac}}-{{mat}}" readonly
                                                                    formControlName="precioCompra">
                                                                <mat-icon matSuffix>attach_money</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Precio Venta</mat-label>
                                                                <input matInput type="text" placeholder="Precio Venta"
                                                                    formControlName="precioVenta" readonly
                                                                    id="precioVentaMat-{{ac}}-{{mat}}">
                                                                <mat-icon matSuffix>attach_money</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Participacion</mat-label>
                                                                <input type="number" matInput placeholder="Porcentaje"
                                                                    id="participacionMat-{{ac}}-{{mat}}"
                                                                    formControlName="participacion">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Porcentaje</mat-label>
                                                                <input matInput type="text" placeholder="Porcentaje"
                                                                    formControlName="porcentaje" readonly
                                                                    id="porcentajeMat-{{ac}}-{{mat}}">
                                                                <mat-icon matSuffix>%</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <button class="btndelete" color="warn" mat-icon-button
                                                            [disabled]="mat==0" (click)="deleteMarteriaRow(ac,mat)">
                                                            <mat-icon>cancel</mat-icon>
                                                        </button>
                                                    </div>
                                                </div>
                                            </mat-card-content>

                                            <button mat-fab aria-label="add" mat-mini-fab class="btnadd" type="button"
                                                color="accent" (click)="addMateriaprima(ac)">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </mat-card>
                                        <!-- rendimiento materia prima -->
                                        <mat-card class="mat-card-cruce">
                                            <mat-card-header>
                                                <mat-card-title>Materia Prima {{acti.value.materiaprima[0].producto}}
                                                </mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content>
                                                <div fxLayout="row wrap">
                                                    <div class="gr" fxFlex="30%" fxFlex.xs="30%" fxFlex.sm="30%">
                                                        <mat-form-field>
                                                            <input type="text" readonly matInput placeholder="Unidad"
                                                                id="rendUnidad{{ac}}" formControlName="rendUnidad">
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="25%" fxFlex.xs="25%" fxFlex.sm="25%">
                                                        <mat-form-field>
                                                            <input type="text" matInput placeholder="Cantidad"
                                                                id="rendCantidad{{ac}}" required
                                                                formControlName="rendCantidad">
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="45%" fxFlex.xs="45%" fxFlex.sm="45%">
                                                        <mat-form-field>
                                                            <input type="text" matInput placeholder="Materia Prima"
                                                                id="rendMateriaprima{{ac}}" readonly
                                                                formControlName="rendMateriaprima">
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                        <mat-form-field appearance="outline">
                                                            <mat-label>Frecuencia</mat-label>
                                                            <mat-select formControlName="rendFrecuencia" required>
                                                                <mat-option>Frecuencia</mat-option>
                                                                <mat-option *ngFor="let frec of frecuencia"
                                                                    [value]="frec">
                                                                    {{frec.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                        <mat-form-field appearance="outline">
                                                            <mat-label>Valor Unidad</mat-label>
                                                            <input matInput type="tel" placeholder="Valor Unidad"
                                                                formControlName="rendValorU" id="rendValorU{{ac}}">
                                                            <mat-icon matSuffix>attach_money</mat-icon>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                        <mat-form-field appearance="outline">
                                                            <mat-label>Valor total</mat-label>
                                                            <input matInput type="tel" placeholder="Valor total"
                                                                readonly formControlName="rendValorT"
                                                                id="rendValorT{{ac}}">
                                                            <mat-icon matSuffix>attach_money</mat-icon>
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                        <mat-form-field appearance="outline">
                                                            <mat-label>Cantidad Total</mat-label>
                                                            <input matInput type="text" readonly
                                                                formControlName="rendTotal" id="rendTotal{{ac}}">
                                                        </mat-form-field>
                                                    </div>
                                                </div>
                                            </mat-card-content>
                                        </mat-card>
                                    </ng-container>
                                    <!-- Costo de venta -->
                                    <ng-container *ngIf="acti.value.tipo==1">
                                        <mat-card class="mat-card-cruce">
                                            <mat-card-header>
                                                <mat-card-title>Costo de venta</mat-card-title>
                                                <mat-chip-list>
                                                    <mat-chip class="chip-full" color="primary" selected
                                                        matTooltip="Margen" matTooltipPosition="below">
                                                        {{acti.value.margen}} %</mat-chip>
                                                    <mat-chip class="chip-full" color="accent" selected
                                                        matTooltip="Costo" matTooltipPosition="below">
                                                        {{acti.value.costo}} %</mat-chip>
                                                </mat-chip-list>
                                            </mat-card-header>
                                            <br>
                                            <mat-card-content>
                                                <div formArrayName="costoventa" class="alternate">
                                                    <div *ngFor="let prod of costoventa(ac).controls; let cos=index"
                                                        [formGroupName]="cos" fxLayout="row wrap" class="content">

                                                        <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                            <mat-form-field>
                                                                <input type="text" matInput placeholder="Nombre"
                                                                    id="nombre{{cos}}" formControlName="nombre">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="49%" fxFlex.xs="49%" fxFlex.sm="49%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Precio Compra</mat-label>
                                                                <input type="tel" matInput placeholder="Precio Compra"
                                                                    autocomplete="off"
                                                                    id="precioCompraCos{{ac}}-{{cos}}"
                                                                    formControlName="precioCompra">
                                                                <mat-icon matSuffix>attach_money</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="49%" fxFlex.xs="49%" fxFlex.sm="49%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Precio Venta</mat-label>
                                                                <input matInput type="tel" placeholder="Precio Venta"
                                                                    autocomplete="off" formControlName="precioVenta"
                                                                    id="precioVentaCos{{ac}}-{{cos}}">
                                                                <mat-icon matSuffix>attach_money</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="49%" fxFlex.xs="49%" fxFlex.sm="49%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>participacion</mat-label>
                                                                <input matInput type="tel" placeholder="participacion"
                                                                    autocomplete="off" formControlName="participacion">
                                                                <mat-icon matSuffix>%</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="49%" fxFlex.xs="49%" fxFlex.sm="49%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Margen</mat-label>
                                                                <input matInput type="tel" readonly autocomplete="off"
                                                                    formControlName="porcentaje"
                                                                    id="porcentajeCos{{ac}}-{{cos}}">
                                                                <mat-icon matSuffix>%</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <button class="btndelete" color="warn" mat-icon-button
                                                            [disabled]="cos==0" (click)="deleteCostoventaRow(ac,cos)">
                                                            <mat-icon>cancel</mat-icon>
                                                        </button>

                                                    </div>
                                                </div>

                                            </mat-card-content>

                                            <button mat-fab aria-label="add" mat-mini-fab class="btnadd" type="button"
                                                color="accent" (click)="addCostoventa(ac)">
                                                <mat-icon>add</mat-icon>
                                            </button>
                                        </mat-card>
                                    </ng-container>
                                    <!-- compras -->
                                    <mat-card class="mat-card-cruce">
                                        <mat-card-header>
                                            <ng-container *ngIf="acti.value.tipo ==1">
                                                <mat-card-title>Ventas Máximas</mat-card-title>
                                                <!-- <mat-card-subtitle>Compras</mat-card-subtitle> -->
                                            </ng-container>
                                            <ng-container *ngIf="acti.value.tipo ==2">
                                                <mat-card-title>Compras</mat-card-title>
                                            </ng-container>
                                            <ng-container *ngIf="acti.value.tipo ==3">
                                                <mat-card-title>Servicios</mat-card-title>
                                            </ng-container>
                                            <ng-container *ngIf="acti.value.tipo ==4">
                                                <mat-card-title>Arriendos</mat-card-title>
                                            </ng-container>
                                            <mat-chip-list class="pull-right">
                                                <mat-chip color="accent" selected>
                                                    ${{acti.value.totalCompras}}
                                                </mat-chip>
                                            </mat-chip-list>
                                        </mat-card-header>

                                        <mat-card-content>
                                            <div formArrayName="compras" class="alternate">
                                                <div *ngFor="let comp of compras(ac).controls; let com=index"
                                                    [formGroupName]="com" class="content">
                                                    <div fxLayout="row wrap">
                                                        <div class="gr" fxFlex="20%" fxFlex.xs="20%" fxFlex.sm="20%">
                                                            <mat-form-field>
                                                                <input type="number" matInput placeholder="Cantidad"
                                                                    id="cantidad{{ac}}-{{com}}"
                                                                    formControlName="cantidad">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field>
                                                                <input type="text" matInput placeholder="Descripcion"
                                                                    id="descripcion{{ac}}-{{com}}"
                                                                    formControlName="descripcion">
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="30%" fxFlex.xs="30%" fxFlex.sm="30%">
                                                            <mat-form-field>
                                                                <mat-label>Frecuencia</mat-label>
                                                                <mat-select formControlName="frecuencia"
                                                                    id="frecuencia{{ac}}-{{com}}" required>
                                                                    <mat-option>--</mat-option>
                                                                    <mat-option *ngIf="acti.value.tipo ==4"
                                                                        [value]="tipoAnual">{{tipoAnual.name}}
                                                                    </mat-option>
                                                                    <ng-container *ngIf="acti.value.tipo !=4">
                                                                        <mat-option *ngFor="let frec of frecuencia"
                                                                            [value]="frec">
                                                                            {{frec.name}}
                                                                        </mat-option>
                                                                    </ng-container>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="45%" fxFlex.sm="50%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Valor</mat-label>
                                                                <input matInput type="tel" placeholder="Valor"
                                                                    formControlName="valor" id="valor{{ac}}-{{com}}">
                                                                <mat-icon matSuffix>attach_money</mat-icon>
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="gr" fxFlex="50%" fxFlex.xs="50%" fxFlex.sm="50%">
                                                            <mat-form-field appearance="outline">
                                                                <mat-label>Total</mat-label>
                                                                <input matInput type="text" readonly
                                                                    formControlName="total" id="total{{ac}}-{{com}}">
                                                                <mat-icon matSuffix>attach_money</mat-icon>
                                                            </mat-form-field>
                                                        </div>

                                                        <button class="btndelete" color="warn" mat-icon-button
                                                            [disabled]="com==0" (click)="removeCompras(ac,com)">
                                                            <mat-icon>cancel</mat-icon>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </mat-card-content>

                                        <button mat-fab aria-label="add" mat-mini-fab class="btnadd" type="button"
                                            color="accent" (click)="addCompras(ac)">
                                            <mat-icon>add</mat-icon>
                                        </button>
                                    </mat-card>
                                    <!-- costo de venta -->
                                    <ng-container *ngIf="acti.value.tipo ==4 || acti.value.tipo==3">
                                        <mat-card class="mat-card-cruce">
                                            <mat-card-header>
                                                <mat-card-title>Costo de venta</mat-card-title>
                                            </mat-card-header>
                                            <mat-card-content>
                                                <div class="gr" fxFlex="100%" fxFlex.xs="100%" fxFlex.sm="100%">
                                                    <mat-form-field>
                                                        <input type="number" autocomplete="off" matInput
                                                            placeholder="Costo Venta" formControlName="costo">
                                                    </mat-form-field>
                                                </div>
                                            </mat-card-content>
                                        </mat-card>
                                    </ng-container>

                                </mat-expansion-panel>
                            </mat-accordion>

                        </ng-container>
                    </div>
                </mat-tab>
            </div>
        </mat-tab-group>
    </form>
</ng-container>